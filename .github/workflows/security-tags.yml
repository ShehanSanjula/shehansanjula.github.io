name: Inject Security Headers
on:
  push:
    branches: ["main"] # Or your default branch

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Inject CSP Meta Tag
        run: |
          # This finds the <head> tag and appends the meta tag immediately after it
          # You can customize the 'content' string below
          find . -name "*.html" -exec sed -i '/<head>/a \  <meta http-equiv="Content-Security-Policy" content="default-src \x27self\x27; script-src \x27self\x27 \x27unsafe-inline\x27 https://kit.fontawesome.com https://images.dmca.com https://static.cloudflareinsights.com https://cdnjs.cloudflare.com https://www.googletagmanager.com https://www.clarity.ms https://cdn.jsdelivr.net https://res.cloudinary.com https://*.credly.com https://*.youracclaim.com; style-src \x27self\x27 \x27unsafe-inline\x27 https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://kit.fontawesome.com; font-src \x27self\x27 https://fonts.gstatic.com https://cdnjs.cloudflare.com https://kit.fontawesome.com; img-src \x27self\x27 data: https://res.cloudinary.com https://images.dmca.com https://www.google-analytics.com https://*.clarity.ms https://c.bing.com https://cdn.credly.com https://*.youracclaim.com https://*.blogspot.com https://drive.google.com; connect-src \x27self\x27 https://www.google-analytics.com https://*.clarity.ms https://c.bing.com https://www.googletagmanager.com https://sentry.io; frame-src \x27self\x27 https://www.credly.com https://www.youracclaim.com; object-src \x27none\x27; base-uri \x27self\x27;">\n  <meta name="referrer" content="strict-origin-when-cross-origin">' {} +

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
